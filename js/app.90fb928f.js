(function(e){function t(t){for(var r,c,a=t[0],i=t[1],l=t[2],d=0,s=[];d<a.length;d++)c=a[d],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&s.push(o[c][0]),o[c]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);f&&f(t);while(s.length)s.shift()();return u.push.apply(u,l||[]),n()}function n(){for(var e,t=0;t<u.length;t++){for(var n=u[t],r=!0,a=1;a<n.length;a++){var i=n[a];0!==o[i]&&(r=!1)}r&&(u.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},o={app:0},u=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/editor/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],i=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var f=i;u.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"7a2a":function(e,t,n){"use strict";n("e3ef")},c492:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23"),o={class:"app"},u=Object(r["m"])("h1",null,"这个是页面内容",-1);function c(e,t,n,c,a,i){var l=Object(r["M"])("visual-editor");return Object(r["D"])(),Object(r["i"])("div",o,[u,Object(r["m"])(l,{modelValue:e.jsonData,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.jsonData=t}),config:e.visualConfig},null,8,["modelValue","config"])])}n("4de4"),n("4160"),n("d81d"),n("d3b7"),n("25f0"),n("159b");var a=n("2909"),i=n("5530");n("c492");function l(e){var t=e.component,n=e.left,r=e.top;return{top:r,left:n,componentKey:t.key,adjustPosition:!0,focus:!1}}function f(){var e=[],t={};return{componentList:e,componentMap:t,registry:function(n,r){var o=Object(i["a"])(Object(i["a"])({},r),{},{key:n});e.push(o),t[n]=o}}}function d(e,t){var n=Object(r["I"])(e());return Object(r["Y"])(e,(function(e){e!==n.value&&(n.value=e)})),{get value(){return n.value},set value(e){n.value!==e&&(n.value=e,t(e))}}}Object(r["n"])({props:{modelValue:{type:String}},emit:{"update:modelValue":function(e){return e}},setup:function(e,t){var n=d((function(){return e.modelValue}),(function(e){return t.emit("update:modelValue",e)}));return function(){return Object(r["m"])("div",null,[Object(r["l"])("自定义输入框"),Object(r["bb"])(Object(r["m"])("input",{type:"text","onUpdate:modelValue":function(e){return n.value=e}},null),[[r["W"],n.value]])])}}});function s(e){return"function"===typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!Object(r["s"])(e)}var v=Object(r["n"])({props:{block:{type:Object,required:!0},config:{type:Object,required:!0}},setup:function(e){var t=Object(r["I"])({}),n=Object(r["g"])((function(){return["visual-editor-block",{"visual-editor-block-focus":e.block.focus}]})),o=Object(r["g"])((function(){return{top:"".concat(e.block.top,"px"),left:"".concat(e.block.left,"px")}}));return Object(r["A"])((function(){var n=e.block;if(!0===n.adjustPosition){var r=t.value,o=r.offsetWidth,u=r.offsetHeight;n.left=n.left-o/2,n.top=n.top-u/2,n.adjustPosition=!1}})),function(){var u=e.config.componentMap[e.block.componentKey],c=u.render();return Object(r["m"])("div",{class:n.value,style:o.value,ref:t},s(c)?c:{default:function(){return[c]}})}}}),p=(n("c975"),n("a15b"),n("fb6a"),n("b0c0"),{16:"shift",17:"ctrl",18:"alt",8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",46:"delete",189:"-",187:"=",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"});function b(){var e=Object(r["H"])({current:-1,queue:[],commandArray:[],commands:{},destroyList:[]}),t=function(t){e.commandArray.push(t),e.commands[t.name]=function(){var n=t.execute.apply(t,arguments),r=n.undo,o=n.redo;if(o(),!1!==t.followQueue){var u=e.queue,c=e.current;u.length>0&&(u=u.slice(0,c+1),e.queue=u),u.push({undo:r,redo:o}),e.current=c+1}}},n=function(){var t=function(t){if(document.activeElement===document.body){var n=t.keyCode,r=t.shiftKey,o=t.altKey,u=t.ctrlKey,c=t.metaKey,a=[];(u||c)&&a.push("ctrl"),r&&a.push("shift"),o&&a.push("alt"),a.push(p[n]);var i=a.join("+");e.commandArray.forEach((function(n){var r=n.keyboard,o=n.name;if(r){var u=Array.isArray(r)?r:[r];u.indexOf(i)>-1&&(e.commands[o](),t.stopPropagation(),t.preventDefault())}}))}},n=function(){return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}};return n}(),o=function(){e.commandArray.forEach((function(t){return!!t.init&&e.destroyList.push(t.init())})),e.destroyList.push(n())};return t({name:"undo",keyboard:"ctrl+z",followQueue:!1,execute:function(){return{redo:function(){if(-1!==e.current){var t=e.queue[e.current];t&&(t.undo&&t.undo(),e.current--)}}}}}),t({name:"redo",keyboard:["ctrl+y","ctrl+shift+z"],followQueue:!1,execute:function(){return{redo:function(){var t=e.queue[e.current+1];t&&(t.redo(),e.current++)}}}}),Object(r["B"])((function(){return e.destroyList.forEach((function(e){return!!e&&e()}))})),{state:e,registry:t,init:o}}var m=n("4979"),g=n.n(m);function j(e){var t=e.focusData,n=e.updateBlocks,r=e.dataModel,o=e.dragstart,u=e.dragend,c=b();return c.registry({name:"delete",keyboard:["backspace","delete","ctrl+d"],execute:function(){var e={before:r.value.blocks||[],after:t.value.unFocus};return{redo:function(){n(g()(e.after))},undo:function(){n(g()(e.before))}}}}),c.registry({name:"drag",init:function(){var e=this;this.data={before:null};var t={dragstart:function(){return e.data.before=g()(r.value.blocks||[])},dragend:function(){return c.state.commands.drag()}};return o.on(t.dragstart),u.on(t.dragend),function(){o.off(t.dragstart),u.off(t.dragend)}},execute:function(){var e=this.data.before,t=g()(r.value.blocks||[]);return{redo:function(){n(g()(t))},undo:function(){n(g()(e))}}}}),c.registry({name:"clear",execute:function(){var e={before:g()(r.value.blocks),after:g()([])};return{redo:function(){n(g()(e.after))},undo:function(){n(g()(e.before||[]))}}}}),c.init(),{undo:function(){return c.state.commands.undo()},redo:function(){return c.state.commands.redo()},delete:function(){return c.state.commands.delete()},clear:function(){return c.state.commands.clear()}}}function O(){var e=[];return{on:function(t){e.push(t)},off:function(t){e=e.filter((function(e){return e!==t}))},emit:function(){e.forEach((function(e){return e()}))}}}function y(e){return"function"===typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!Object(r["s"])(e)}var h=Object(r["n"])({props:{modelValue:{type:Object,required:!0},config:{type:Object,required:!0}},emits:{"update:modelValue":function(e){return!0}},setup:function(e,t){var n=d((function(){return e.modelValue}),(function(e){return t.emit("update:modelValue",e)})),o=Object(r["I"])({}),u=Object(r["g"])((function(){return{width:"".concat(n.value.container.width,"px"),height:"".concat(n.value.container.height,"px")}})),c=Object(r["g"])((function(){var e=[],t=[];return(n.value.blocks||[]).forEach((function(n){return(n.focus?e:t).push(n)})),{focus:e,unFocus:t}})),f=O(),s=O(),p={clearFocus:function(e){var t=n.value.blocks||[];0!==t.length&&(e&&(t=t.filter((function(t){return t!==e}))),t.forEach((function(e){return e.focus=!1})))},updateBlocks:function(e){n.value=Object(i["a"])(Object(i["a"])({},n.value),{},{blocks:e})}},b=function(){var e=null,t={dragstart:function(t,n){o.value.addEventListener("dragenter",r.dragenter),o.value.addEventListener("dragover",r.dragover),o.value.addEventListener("dragleave",r.dragleave),o.value.addEventListener("drop",r.drop),e=n,f.emit()},dragend:function(){o.value.removeEventListener("dragenter",r.dragenter),o.value.removeEventListener("dragover",r.dragover),o.value.removeEventListener("dragleave",r.dragleave),o.value.removeEventListener("drop",r.drop),e=null}},r={dragenter:function(e){return e.dataTransfer.dropEffect="move"},dragover:function(e){return e.preventDefault()},dragleave:function(e){return e.dataTransfer.dropEffect="none"},drop:function(t){var r=Object(a["a"])(n.value.blocks||[]);r.push(l({component:e,top:t.offsetY,left:t.offsetX})),p.updateBlocks(r),s.emit()}};return t}(),m=function(){return{container:{onMousedown:function(e){e.preventDefault(),e.currentTarget===e.target&&(e.shiftKey||p.clearFocus())}},block:{onMousedown:function(e,t){e.shiftKey?c.value.focus.length<=1?t.focus=!0:t.focus=!t.focus:t.focus||(t.focus=!0,p.clearFocus(t)),g.mousedown(e)}}}}(),g=function(){var e={startX:0,startY:0,startPos:[],dragging:!1},t=function(t){e={startX:t.clientX,startY:t.clientY,startPos:c.value.focus.map((function(e){var t=e.top,n=e.left;return{top:t,left:n}})),dragging:!1},document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)},n=function(t){var n=t.clientX-e.startX,r=t.clientY-e.startY;e.dragging||(e.dragging=!0,f.emit()),c.value.focus.forEach((function(t,o){t.top=e.startPos[o].top+r,t.left=e.startPos[o].left+n}))},r=function t(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",t),e.dragging&&s.emit()};return{mousedown:t}}(),h=j({focusData:c,updateBlocks:p.updateBlocks,dataModel:n,dragstart:f,dragend:s}),k=[{label:"撤销",icon:"icon-back",handler:h.undo,tip:"ctrl+z"},{label:"重做",icon:"icon-forward",handler:h.redo,tip:"ctrl+y, ctrl+shift+z"},{label:"删除",icon:"icon-delete",handler:function(){return h.delete()},tip:"ctrl+d, backspace, delete"},{label:"清空",icon:"icon-reset",handler:function(){return h.clear()},tip:"ctrl+d, backspace, delete"}];return function(){return Object(r["m"])("div",{class:"visual-editor"},[Object(r["m"])("div",{class:"visual-editor-menu"},[e.config.componentList.map((function(e){return Object(r["m"])("div",{class:"visual-editor-menu-item",draggable:!0,onDragend:b.dragend,onDragstart:function(t){return b.dragstart(t,e)}},[Object(r["m"])("span",{class:"visual-editor-menu-item-label"},[e.label]),e.preview()])}))]),Object(r["m"])("div",{class:"visual-editor-head"},[k.map((function(e,t){var n;return Object(r["m"])(Object(r["M"])("el-tooltip"),{effect:"dark",content:e.tip,placement:"bottom"},y(n=Object(r["m"])("div",{key:t,class:"visual-editor-head-button",onClick:e.handler},[Object(r["m"])("i",{class:"iconfont ".concat(e.icon)},null),Object(r["m"])("span",null,[e.label])]))?n:{default:function(){return[n]}})}))]),Object(r["m"])("div",{class:"visual-editor-operator"},[Object(r["l"])("visual-editor-operator")]),Object(r["m"])("div",{class:"visual-editor-body"},[Object(r["m"])("div",{class:"visual-editor-content"},[Object(r["m"])("div",Object(r["t"])({class:"visual-editor-container",style:u.value,ref:o},m.container),[!!n.value.blocks&&n.value.blocks.map((function(t,n){return Object(r["m"])(v,Object(r["t"])({config:e.config,block:t,key:n},{onMousedown:function(e){return m.block.onMousedown(e,t)}}),null)}))])])])])}}}),k=n("3fd4"),w=f();w.registry("text",{label:"文本",preview:function(){return"预览文本"},render:function(){return"渲染文本"}}),w.registry("button",{label:"按钮",preview:function(){return Object(r["m"])(k["a"],null,{default:function(){return[Object(r["l"])("按钮")]}})},render:function(){return Object(r["m"])(k["a"],null,{default:function(){return[Object(r["l"])("渲染按钮")]}})}}),w.registry("input",{label:"输入框",preview:function(){return Object(r["m"])(k["b"],null,null)},render:function(){return Object(r["m"])(k["b"],null,null)}});var E=Object(r["n"])({name:"App",components:{VisualEditor:h},data:function(){return{visualConfig:w,jsonData:{container:{height:500,width:800},blocks:[{top:200,left:100,componentKey:"text"},{top:100,left:100,componentKey:"button"},{top:200,left:200,componentKey:"input"}]}}}});n("7a2a");E.render=c;var x=E,L=(n("7dd6"),Object(r["h"])(x));L.use(k["c"]),L.mount("#app")},e3ef:function(e,t,n){}});
//# sourceMappingURL=app.90fb928f.js.map